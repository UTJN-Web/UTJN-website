generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int      @id @default(autoincrement())
  lastName         String
  firstName        String
  email             String   @unique
  major             String
  graduationYear   Int
  currentYear      String   @default("1st year") // Current academic year (1st, 2nd, 3rd, 4th)
  university        String   @default("University of Toronto")
  cognitoSub        String   @unique
  joinedAt         DateTime @default(now())
  
  // Event relationships
  registeredEvents EventRegistration[]
}

model Event {
  id              Int      @id @default(autoincrement())
  name            String
  description     String
  targetYear      String   // e.g., "All years", "1st-2nd year", etc.
  fee             Float    @default(0)
  capacity        Int
  isArchived      Boolean  @default(false)
  isUofTOnly      Boolean  @default(false)  // If true, only UofT students can see/register
  date            DateTime
  type            String   // e.g., "career", "social"
  image           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Event relationships
  registrations   EventRegistration[]
}

model EventRegistration {
  id              Int      @id @default(autoincrement())
  userId          Int
  eventId         Int
  registeredAt    DateTime @default(now())
  paymentStatus   String   @default("pending") // "pending", "completed", "failed"
  
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event           Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  @@unique([userId, eventId])
}
